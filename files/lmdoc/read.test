;THIS IS A TEST FILE FOR USE IN MEASURING THE SPEED OF READ.
;PLEASE DONT DISTURB THIS FILE

(SETQ SGFCTN '( ALLOCATE-STACK-GROUP-STORAGE (MACRO-COMPILE STACK-GROUP-PRESET) 
))

(DEFUN ALLOCATE-STACK-GROUP-STORAGE (SWAPPING-OPTIONS PDL-AREA PDL-SIZE 
					L-B-P-AREA L-B-P-SIZE)
   (PROG (PDL-ARRAY L-B-P-ARRAY)
	(SETQ L-B-P-ARRAY 
		(MAKE-ARRAY-BLOCK L-B-P-AREA 'ART-PDL-SEGMENT (LIST L-B-P-SIZE) 
			NIL (LENGTH PDL-SEGMENT-LEADER-QS)))
	(SETQ PDL-ARRAY 
		(MAKE-ARRAY-BLOCK PDL-AREA 'ART-STACK-GROUP-HEAD (LIST PDL-SIZE) 
			NIL (LENGTH STACK-GROUP-HEAD-LEADER-QS)))
	(STORE-ARRAY-LEADER L-B-P-ARRAY PDL-SEG-SG-HEAD-POINTER PDL-ARRAY)
	(STORE-ARRAY-LEADER PDL-ARRAY SG-PDL-STORAGE-ARRAY PDL-ARRAY)
	(STORE-ARRAY-LEADER PDL-ARRAY SG-LINEAR-BINDING-ARRAY L-B-P-ARRAY)
	(STORE-ARRAY-LEADER PDL-ARRAY SG-STATE SWAPPING-OPTIONS)
	(RETURN (%SDATTP PDL-ARRAY DTP-STACK-GROUP))))

(DEFUN STACK-GROUP-PRESET (STACK-GROUP FCTN &REST ARGS)
   (PROG (ARRAYP IDX SG-STATE-Q)
	(COND ((NOT (= (%DATTP STACK-GROUP) DTP-STACK-GROUP))
		(GO E)))
	(SETQ ARRAYP (%SDATTP STACK-GROUP DTP-ARRAY-POINTER))
	(COND ((OR (NOT (= (%P-MASK-FIELD %%ARRAY-TYPE-FIELD ARRAYP) ART-STACK-GROUP-HEAD))
		   (= (%LDB %%SG-ST-CURRENT-STATE 
			   (SETQ SG-STATE-Q (ARRAY-LEADER ARRAYP SG-STATE)))
		      SG-STATE-ACTIVE))
		(GO E)))
	(AS-1 0 ARRAYP 0)		;LPCLS Q
	(AS-1 0 ARRAYP 1)		;LPEXS Q
	(AS-1 0 ARRAYP 2)		;LPENS Q
	(AS-1 FCTN ARRAYP 3)		;LPFEF Q
	(SETQ IDX 3)
	(STORE-ARRAY-LEADER ARRAYP SG-INITIAL-FCTN-INDEX IDX)
	(STORE-ARRAY-LEADER ARRAYP SG-AP IDX)
	(STORE-ARRAY-LEADER ARRAYP SG-IPMARK IDX)
	(STORE-ARRAY-LEADER ARRAYP SG-SAVED-NARGS (LENGTH ARGS))
   L	(COND ((NULL ARGS) (GO X1)))
	(AS-1 (CAR ARGS) ARRAYP (SETQ IDX (1+ IDX)))
	(SETQ ARGS (CDR ARGS))
	(GO L)
   X1	(STORE-ARRAY-LEADER ARRAYP SG-PDL-PDL-POINTER IDX)
	(STORE-ARRAY-LEADER ARRAYP SG-LB-PDL-POINTER 0)
	(STORE-ARRAY-LEADER ARRAYP SG-U-STACK-QS 0)
	(SETQ SG-STATE-Q (%DPB (%LDB %%SG-ST-CURRENT-STATE SG-STATE-Q)
			       %%SG-ST-PREVIOUS-STATE 
			       (%DPB SG-STATE-AWAITING-INITIAL-CALL 
				     %%SG-ST-CURRENT-STATE 
				     SG-STATE-Q)))
	(STORE-ARRAY-LEADER ARRAYP SG-STATE SG-STATE-Q)
	(RETURN T)
   E	(PRINT '(BAD-STACK-GROUP STACK-GROUP-PRESET))
	(RETURN NIL)))

;(DEFUN STACK-GROUP-PRESET (&REST ARGS)
;   (PROG (SG)
;	(SETQ SG (CAR ARGS))
;	(SETQ ARGS (CDR ARGS))
;	(%OPEN-CALL-BLOCK (CAR ARGS) 0 4)
; 	(SETQ ARGS (CDR ARGS))
;    L	(COND ((NULL ARGS) (GO X)))
;	(%PUSH (CAR ARGS))
;	(SETQ ARGS (CDR ARGS))
;	(GO L)
;    X	(%STACK-GROUP-PRESET SG)
;	(RETURN T)
;	))

