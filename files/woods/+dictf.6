(DECLARE (SPECIAL WOODS-DICTIONARY WOODS-DICTIONARY-AREA WOODS-DICTIONARY-ARRAY))

(COND ((NULL (BOUNDP 'WOODS-DICTIONARY-AREA))
       (DEFINE-AREA 'WOODS-DICTIONARY-AREA 200000)))

(DEFUN GOBBLE-DICTIONARY (FILENAME &AUX STREAM)
  (OR (BOUNDP 'WOODS-DICTIONARY-AREA)
      (ERROR "DEFINE WOODS-DICTIONARY-AREA PLEASE"))
  (PROG (TEM CH WORD DATA)
        (SETQ STREAM (OPEN FILENAME '(READ)))
        (SETQ WOODS-DICTIONARY NIL)
   NEW-ENTRY
        (SETQ CH (FUNCALL STREAM 'TYI))
        (COND ((NULL CH)
               (CLOSE STREAM)
               (RETURN T))
              ((= CH 133) (GO READ-WORD))
              ((GO NEW-ENTRY)))
   READ-WORD
        (SETQ WORD (GOBBLE-DICTIONARY-STRING 40 NIL STREAM))
        (SETQ DATA (GOBBLE-DICTIONARY-STRING 135 T STREAM))
        (SETQ WOODS-DICTIONARY (CONS-IN-AREA (CONS-IN-AREA WORD DATA WOODS-DICTIONARY-AREA)
					     WOODS-DICTIONARY WOODS-DICTIONARY-AREA))
        (GO NEW-ENTRY)))

(DEFUN GOBBLE-DICTIONARY-STRING (DELIMITER SLASHIFYP STREAM)
  (PROG (CH STRING IDX)
   SKIP-SPACES
        (SETQ CH (FUNCALL STREAM 'TYI "UNEXPECTED EOF IN DICTIONARY"))
        (AND (= CH 215) (SETQ CH 40))          ;CARRIAGE RETURNS INTO SPACES
        (AND (= CH 40) (GO SKIP-SPACES))
        (SETQ IDX 0
              STRING (MAKE-ARRAY WOODS-DICTIONARY-AREA 'ART-STRING '(1000)))
   ACCUMULATE
        (COND ((= CH DELIMITER)
               (ADJUST-ARRAY-SIZE STRING IDX)
               (RETURN STRING))
              ((NOT SLASHIFYP))
              ((MEMQ CH '(57 56 54 73 47 42))
               (AS-1 57 STRING IDX)
               (SETQ IDX (1+ IDX))))
        (AS-1 CH STRING IDX)
        (SETQ IDX (1+ IDX))
        (SETQ CH (FUNCALL STREAM 'TYI "UNEXPECTED EOF IN DICTIONARY"))
        (AND (= CH 215) (SETQ CH 40))          ;CARRIAGE RETURNS INTO SPACES
        (GO ACCUMULATE)))

(DEFUN MAKE-DICTIONARY-ARRAY (&AUX LENGTH ARRAY)
  (SETQ LENGTH (LENGTH WOODS-DICTIONARY))
  (SETQ ARRAY (MAKE-ARRAY WOODS-DICTIONARY-AREA 'ART-Q (LIST LENGTH)))
  (DO ((I (1- LENGTH) (1- I))
       (L WOODS-DICTIONARY (CDR L)))
      ((< I 0)
       (SETQ WOODS-DICTIONARY-ARRAY ARRAY)
       'WOODS-DICTIONARY-ARRAY)
    (AS-1 (CAR L) ARRAY I)))
