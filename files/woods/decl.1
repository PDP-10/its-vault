;READ WOODS;MACROS > IN BEFORE TRYING TO THIS INTERPRETIVELY

(DECLARE (COND ((NULL (MEMQ 'NEWIO (STATUS FEATURES)))
		(BREAK 'YOU-HAVE-TO-COMPILE-THIS-WITH-QCOMPL T))
	       ((NULL (GET 'IF-FOR-MACLISP 'MACRO))
		(LOAD '(MACROS > DSK WOODS)))))

(IF-FOR-LISPM
(DECLARE (QUOTED-ARGS 
  FORCE  PUSH  SCANSTACK  SYSCONJ  ADDL  ADDR 
  CAT  GETF  GETR  JUMP  LIFTR  NULLR 
  SENDR  SENDRQ  SETR  SETRQ  TO  TODO 
  WRD  CHECKF  COMPARATIVE  GETROOT  MARKER  NPCHECK 
  NPREP  PNCHECK  RESUMETAG  RFEAT  SCOMP  VPARTICLE 
  VPASSIVE  VPREP  VTRANS  HELPER  MAPCV  RENAME 
  SCANCV  SETQS  THOSEV  EDITD  EDITG  REMEX 
  CTYPE  PLURAL  COMPFORM  SUPFORM  /#  MEM 
  PRED  QUANT  SSUNIONF  NEWFRAG  TABFORM))
);LISPM

(DECLARE (*LEXPR APPLY* EVALA)(SPECIAL *LOC*))

(DECLARE  (SPECIAL *SPOP *TRAIL REG WHERE *SQ-VAL*)
(*LEXPR CONCAT))

(DECLARE (SPECIAL /#FLG * *ACFS *STATE *X* -FLG A0 A1 ABUF ACF/# ACFS
		  ACONFIG ACT ACTION ACTIONS ADJ AHELP ALIST ALT
		  ALTARC ALTARC1 ALTCONJ ALTLEX ALTNUM ALTS ALTWFS
		  ANAPHORISM ANAPHRLST ANTECEDANTS ANTEVAR ARC ARCS
		  ARGS ASSIST ATOM ATOMS AVERAGEFLAG BEG BEGIN
		  BLOCKS C2 CAND CAT CATEGORIES CLIST CMODE CONFIG
		  CONJ CONTEXT CONTINUE DALL DET DFILE
		  DICTFETCHFAILS DICTFILE DICTFILEBEG DICTFORM
		  DICTIONARY DISCRULES ECONSES ECONSES0 EDITDV
		  EDITGV EDO END ETIME ETIME0 ETIMEFLAG EXECCOMS
		  EXECUTE FAIL FEAT FEATS FEATURES FILE FILEFNS
		  FILELST FILEMACROS FILEVARS FIRSTFLAG FLAG FORCE
		  FORKNAME FORM FOUND GETFN GLOBALVARS GVARS H1
		  HEAD HEADRULES HEADS HELP HELPER HITFILE HOLD IB
		  ICONSES ICONSES0 IDO IHELP INPUTLOGFILE
		  INPUTLOGFLAG INTENSION INTERP INTERPS INTERVALS
		  IPRINT ITIME ITIME0 ITIMEFLAG ITP KLIST L0 L1 L2
		  L3 L4 LABEL LAMS LETFLG LEX LEXBACK LEXLIST
		  LEXMODE LEXTABLE LH LISPXHISTORY LIST LOC LOGFILE
		  LOGFLAG LOOP LOWFORK LP MACROS MARKER MARKERS
		  MATCHLIST MAXBLOCKS MAXPARSES MAXREPARSES MAXTIME
		  MCATEGORIES MID MINL MINLOC MLIST MODAL MODE
		  MODEVARS MODL MORE-MOST MORPHOLOGYCOMS
		  MORPHOLOGYFNS MORPHTABLE MORPHTESTS MTST
		  MYGLOBALVARS NAME NEWRULES NEWVARS NFLAG NLAMA
		  NLAML NLEX NODE NOMOVEFLAG NOUN NP NPRRULE NU
		  OLDALTS P PAREN// PARENCOUNT PARENS PARSE
		  PARSER10COMS PARSES PARSEXPRS PARSVALS PATH
		  PAUSEFLAG PCONSES PCONSES0 PCTFLG PHELP PMODE
		  PNCODE PPATH PPRINT PPT PREFERRED PREP PRERULES
		  PREVARS PROPS PS PTIME PTIME0 PTIMEFLAG
		  PUNCTUATION PUSH PUSHSTATE QBUF QUANT QVAR
		  READBUF RECORD REFLIST REFLISTS REGS REPARSE
		  REQUESTDEF RESOLVE RETURN RHS RULELIST RULELISTS
		  RVECTOR SCAN SCNFN SCNLST SCORE0 SCORE0SENTS
		  SCORE1 SCORE1SENTS SCORE2 SCORE2SENTS SCORE3
		  SCORE3SENTS SEARCH SEARCHFLAG SEM SEM-NOUNS
		  SEM-VERBS SEMFOR SEMSUB SEMU SENTENCE SENTENCES
		  SETFN SETRUL SETRUL? SIFLAG SKIP SMP SMP2
		  SPECIFIER SPLIT/# SPLITS SREGS SSETRUL STACK
		  STACKELT START STARTCLOCK STATE STRAIL STRING
		  STRINGPOS SUBLOC SUBSTITUTE SUCCESS SUCCESSFLAG
		  SYNFLAG SYSCONJ SYSPROPS T2 TACONFIG TAGLIST
		  TAGMATCH TAILS TEMP TEMPLATE TEMPTRAIL TERMRULE
		  TEST TOP TOPICFLAG TOPICRULES TOPIC\AND-NP
		  TOPIC\AND-S TRACE TRACEFILE TRAIL TRAILARC
		  TRAILLABEL TRAILS TRAILTYPE TRAILV TRAILVAL
		  TREEFRAGS TRULES TST TYPE TYPEFLAG UCFS UEXPRS
		  UFNS UMACROS UNSMASH UPRINT USERFLAG USERFNS V
		  VAL VALUES VARIABLE VARIABLES VARSFLAG VBL VCFS
		  VLIST WEIGHT WFSS WFST WFST3 WFST4 WORD X XPROPS
		  XTF XTP Y)) 

(DECLARE (*EXPR WHILEM WHEREIS USERFN USED? UNWIND TRAILS TRAIL1
		TRAIL TRACEFILE TOPLEVEL? TMATCH TIMEP TERM
		TEMPMATCH TALKER TAILS1 TAILS TAG SYNONYMS?
		SUSPENDW SUSPEND SUPERLATIVE SUBSET STORALT STEP
		SPROC SPREADQM SPOP SORTREFS1 SORTREFS SHOWTIME
		SETUP SETQSM SENTPROC SENDACTP SEMSUB SEMNET
		SEMIANAPHOR SEMCONJ SEM SDIFF SCOPEVARS SCOPEFINDER
		SCAN SBUILD SAMPLEP RULES RMATCH RESOLVE REQUESTDEF
		RELTAG RELATIVIZE RELATEDWORDS REFTYPE REFSUB2
		REFSUB1 REFSUB REFQUANTS REFPTR REFP REFLOC REDO
		QUIT QSTART QGO PUTLEX PUNCTALIZE PRINTPARSES PPT1
		PPT PPR PPP PPG PPD PPATH/.STACK PPATH/.REGS
		PPATH/.HOLD PPATH/.BACK POPCONJ POP PLOG PARSER
		PARSELIST ORMATCH ORFLAG NXTVAR NPBUILD NO-MATCHES
		NEXTWRD NEWPX NEWCLASS MORPHTSTCHECK MORPHTABCHECK
		MORPH MODESET MODAL MEMBSTACK MEMBERS MEANING?
		MATCHGROUP MATCHER MARKERS LONGBLOCK LOCEX LOC LOADFROM
		LINEP LEXPAIRS LEXIC LEXALIZE LEAVES LEAFMEMB
		LASTELT LAMTYPE KTH KILL KEYPHRASE ISOTOPE INTERP
		IMPORT IDENTITY HYPHENADJ HOLDSCAN HOLD HEAD GETTAG
		GETSENT GETREFS GETLEX FRONTED? FORCER FIRSTPART
		FIND FILEX FILEMATCH EVALLOC ENDTRACE ENDL? DWRITE
		DRULEF DOCP DICTFETCH DICTCHECK DICT? DETOUR
		DETBUILD DEFAULTSEM CONTRACTP CONSTITUENTS
		CONJSTARTS CONJSCOPE CONJOIN COMSAV COMBINATIONS
		CHOOSEALT CCHECK CATCHECK BUILD2 BUILD1 BACKUP
		BACKLEX AVERAGE? AUTHOR: ASSOCNEXT ASSIST ARGSOF
		ARGSAV ARCTEST ARCPICK ANTORDER ANTEQUANT
		ANTECEDANT ANAPHORD ALTLOC ALTCONJGEN ALTARCGEN
		ALT/.WEIGHT ALT/.STRING ALT/.STATE ALT/.STACK
		AGREEMENT ADJVERB ADJPHRSE ADDLEX ACT ABORT *FLAG)) 

(DECLARE (*FEXPR WRD WHILE VTRANS VPREP VPASSIVE VPARTICLE TRACER
		 TODO TO THOSEV TABFORM SYSCONJ SUPFORM SSUNIONF
		 SPREADQ SPLIT SHOW SETRQ SETR SETQS SENDRQ SENDR
		 SCOMP SCANSTACK SCANCV RFEAT RESUMETAG RESUME
		 RENAME REMEX QUANT Q PUSH PRED PNCHECK PLURAL
		 NULLR NPREP NPR NPCHECK NOR NEWRULE NEWFRAG MEM
		 MARKER MAPCV LIFTR JUMP HELPER GETROOT GETR GETF
		 FORCE FILE EQUIVALENCE EQU EDITG EDITD DEFINEV
		 DEFINEP DEFINEGL DEFINEG DEFINEDL DEFINEDICT DDEF
		 CTYPE COMPFORM COMPARATIVE CHECKF CHANGEWORD CAT
		 BUILDQ BUILD ADDR ADDL /#)) 

(COMMENT FUNCTIONS NOT DEFINED IN MACLISP OR SOURCE
	 (! *MAP
	    *MAPCON
	    &PRIN1
	    &PRIN2
	    &PRINT
	    *READ
	    *READC
	    *RPLACA
	    *SORT
	    &TERPRI
	    ADDPROP
	    ALTSTACK
	    APPLY*
	    BACKTRACE
	    BREAK1
	    CHANGENAME
	    CLOCK
	    CLOSEF
	    CONCAT
	    CONSCOUNT
	    CONTROL
	    COPY
	    DEFLIST
	    DSUBST
	    EDITE
	    ENDFILE
	    EVALA
	    EVERY
	    FILEPOS
	    FILEVARS
	    FNTYP
	    GETLOWER
	    GETV
	    GLC
	    GNC
	    HISTORYSAVE
	    INFILE
	    INFILEP
	    INTERSECTION
	    INTO
	    LAMBDA
	    LISPX
	    LISPXPRINT
	    LISPXREAD
	    LISTP
	    LOC
	    MAKEFILE
	    MKATOM
	    MKSTRING
	    NCHARS
	    NEQ
	    NEWFILE1
	    NFLCT-ADJ
	    NFLCT-ING
	    NLISTP
	    *NTH
	    OPENP
	    OUTFILE
	    OUTPUT
	    PACK
	    PARSEPARENS
	    PEEKC
	    PLIST
	    POSITION
	    POSTARTPHRS
	    PRINTDEF
	    PRINTFNS
	    PRINTLEVEL
	    PROMPTCHAR
	    RATOM
	    READP
	    READVISE
	    RETFROM
	    RUNFORK
	    SAVESET
	    SELECTQ
	    SFPTR
	    SOME
	    SPACES
	    STKNTH
	    STKSCAN
	    TCONC
	    UNPACK)) 


(DEFUN *RPLACA MACRO (X) (RPLACA X 'RPLACA))


(DEFUN SETQS MACRO (X) 
       ((LABEL FOO
	       '(LAMBDA (Y) 
			(LIST 'SETQ
			      (CAR Y)
			      (COND ((NULL (CDR Y)) (CADDR X)) (T (FUNCALL FOO (CDR Y)))))))
	(CADR X)))
 
(DEFUN SPREADQ MACRO (X)
(CONS 'SETQ (CONS '*LOC* (CONS (CADDR X)
 (MAPCAN '(LAMBDA (X) (CONS X (LIST '(CAR *LOC*) '*LOC* '(CDR *LOC*))))
         (CADR X))))))

(DEFUN WHILE MACRO (X)
(PROG (TAG)
 (SETQ TAG (GENSYM))
 (RETURN (LIST 'PROG NIL
 TAG	(LIST 'COND (APPEND (CDR X) (LIST (LIST 'GO TAG))))))))

(DEFUN T/.SONS MACRO (X) (RPLACA X 'CONSTITUENTS)) 

(DEFUN ALTARC/.TRAIL MACRO (X) (RPLACA X 'CADR)) 

(DEFUN T/.REF MACRO (X) (RPLACA X 'IDENTITY)) 

(DEFUN F/.REF MACRO (X) (RPLACA X 'CADDR)) 

(DEFUN T/.SONS MACRO (X) (RPLACA X 'CONSTITUENTS)) 

(DEFUN F/.SONS MACRO (X) (RPLACA X 'CADR)) 

(DEFUN T/.NODE MACRO (X) (RPLACA X 'CAR)) 

(DEFUN F/.NODE MACRO (X) (RPLACA X 'CAR)) 

(DEFUN STACKELT/.REGS MACRO (X) (RPLACA X 'CADR)) 

(DEFUN POPARC/.FEATURES MACRO (X) (RPLACA X 'CADDDR)) 

(DEFUN POPARC/.FORM MACRO (X) (RPLACA X 'CADR)) 

(DEFUN ARC/.ACTIONS MACRO (X) (RPLACA X 'CDDDR)) 

(DEFUN ARC/.TEST MACRO (X) (RPLACA X 'CADDR)) 

(DEFUN ARC/.LABEL MACRO (X) (RPLACA X 'CADR)) 

(DEFUN ARC/.TYPE MACRO (X) (RPLACA X 'CAR)) 

(DEFUN ALTARC/.ARCS MACRO (X) (RPLACA X 'CADDR)) 

(DEFUN ALTARC/.ACONFIG MACRO (X) (RPLACA X 'CDDDR)) 

(DEFUN PATH/.STRING MACRO (X) (RPLACA X 'CADDR)) 

(DEFUN PATH/.VAL MACRO (X) (RPLACA X 'CAR)) 

(DEFUN PATH/.ARC MACRO (X) (RPLACA X 'CADR)) 

(DEFUN PPA MACRO (X) (RPLACA X 'TH/.CONFIG)) 

(DEFUN PPATH/.STRING MACRO (X) (RPLACA X 'CADR)) 

(DEFUN PPATH/.STATE MACRO (X) (RPLACA X 'CADDDR)) 

(DEFUN PPATH/.PATH MACRO (X) (RPLACA X 'LASTELT)) 

(DEFUN PPATH/.ARC MACRO (X) (RPLACA X 'CAR)) 

(DEFUN PPATH/.ACONFIG MACRO (X) (RPLACA X 'CDR)) 

(DEFUN STACKELT/.PPATH MACRO (X) (RPLACA X 'LASTELT)) 

(DEFUN DEFINEG-GRAMMAR MACRO (X) (RPLACA X 'DEFINEG)) 

(DEFUN DEFINEG-RULES MACRO (X) (RPLACA X 'DEFINEG)) 

(DEFUN EXECUTE MACRO (X) (RPLACA X 'REMEX)) 

