;;; -*-Mode:LISP; Package:USER; Base: 10. -*-
;READ IN LCHESS;CHDEFS > BEFORE RUNNING THIS INTERPRETED..

(DEFUN C-COMPUTE-POSTING NIL 
  (PROG (TWA PPA CURRENT-LOCATION CURRENT-SIDE PC)
	(SETQ TWA (PIECE-TYPE-WOOD-NUMBER-ARRAY PIECE-ARRAY))
	(SETQ PPA (MAKE-ARRAY NIL 
			      'ART-Q
			      (* PIECE-ARRAY-SIZE C-POST-NENTRIES)))
	(SETQ CURRENT-SIDE 0)
	(DO CURRENT-PIECE 0 (1+ CURRENT-PIECE) (= CURRENT-PIECE #o20)
	    (COND ((NOT (ZEROP (SETQ CURRENT-LOCATION (AR-1 PIECE-ARRAY CURRENT-PIECE))))
		   (MULTIPLE-VALUE ()
		     (FUNCALL (AR-1 C-POST-DISPATCH (AR-1 TWA CURRENT-PIECE))))
;		   (AS-1 ... PPA CURRENT-PIECE)
;		   (AS-1 ... PPA (+ PIECE-ARRAY-SIZE CURRENT-PIECE))
		   )))
	(SETQ CURRENT-SIDE 1)
	(DO CURRENT-PIECE 20 (1+ CURRENT-PIECE) (= CURRENT-PIECE #o40)
	    (COND ((NOT (ZEROP (SETQ CURRENT-LOCATION (AR-1 PIECE-ARRAY CURRENT-PIECE))))
		   (MULTIPLE-VALUE ()
		     (FUNCALL (AR-1 C-POST-DISPATCH (AR-1 TWA CURRENT-PIECE))))
;		   (AS-1 ... PPA CURRENT-PIECE)
;		   (AS-1 ... PPA (+ PIECE-ARRAY-SIZE CURRENT-PIECE))
		   )))
	(RETURN PPA)))

;ENTER POSTING WITH
;  OVERALL GAME STATE
;  KING LOCATION / CASTLING POSSIBILITIES ASSESMENT
;  SQUARE-CONTROL S

;POSTING ROUTINE RETURNS
;  OVERALL STRENGTH  CRIPPLED WEAK NORMAL STRONG DOMINANT
;  CHARACTER    DEFENSIVE OFFENSIVE
;  STABILITY (IMPORTANCE INCREASES AS DISTANCE OF STRENGTH FROM NORMAL)
;               ROCK-SOLID NORMAL UNCLEAR

;POSTING N  CHARACTER ... UNDEVELOPED NORMAL ATTACKING DOMINANT
;			DEFENSIVE NEEDS-RETRIEVAL
;  SQUARE-ON
;   ATTACKING-PURPOSES
;    BOARD-EDGE RIM NEAR-CENTER CENTER DEEP-CENTER
;    DISTANCE FROM HIS K IN RANKS, FILES
;  STABILITY (IMPORTANT IF IN STRONG ADVANCED POSITION)
;    IN-HOLE-HIS-P-STRUCTURE
;      SHIELDED BY HIS P
;    DEFENDED BY OUR P
;    EXCHANGE-ABILITY --IF STRONGLY POSTED
;      HE HAS KNIGHTS?  IN POSITION TO EXCHANGE?
;      HE HAS RIGHT FLAVOR B? IN POSITION TO EXCHANGE?
;      OUR OTHER N IN POSITION TO RECAPTURE?
;      OUR OTHER PIECE IN POSITION TO RECAPTURE (AND BE STRONGLY POSTED)?
;  SHIELDING OUR WEAK P
;  SQUARES-HITTING
;    DEFENDED-BY-P [-]
;    HOLE-IN-HIS-P-STRUCTURE
;  DEFENSIVE-PURPOSES
;    DISTANCE FROM OUR K
;    DEFENDED

;POSTING B
;  SQUARE-ON
;    CENTRALIZED NORMAL DEFENSIVE RETARDED
; MOVE-AVAILABLE  0 OR 1 -> BAD
; HITTING-OWN-IMMOBILE-P -> BAD
; HITTING-HIS-P-DEF-BY-P -> BAD
; POINTED-AT-K
; ON LONG DIAG
; FINANCHETTOED
;  CASTLED-K  (DONT TRADE)
; CONFINED

;POSTING R
; RANKWISE - ROOK IN HOME TERRITORY
;  ROOKS COMMUNICATE?
;  GOOD FILES AVAILABLE
; FILEWISE - ROOK IN HOME TERRITORY
;   CENTRAL-FILE?
;   FILE-NEAR-HIS-K?
;  OPEN-FILE
;  HALF-OPEN-FILE-OPEN-TO-USE
;  HALF-OPEN-FILE-OPEN-TO-HIM
;   PAWN-BREAK LIKELY?
;  CLOSED-FILE
;   PAWN-BREAK LIKELY?
;  DEEP SQUARES AVAILABLE? (ESP 7TH OR 8TH RANK)
; RANKWISE - ROOK IN ENEMY TERRITORY
;  ABOUT TO COLLECT HIS PAWNS?
; FILEWISE - ROOK IN ENEMY TERRITORY

;POSTING Q
; EXPOSED?
; ACTIVE?
; NEAR-HIS-K?

;POSTING K
; OPENING-MIDDLE GAME
; END-GAME

;IMPORTANT VARIABLES  
(DECLARE (SPECIAL 
  OUR-SIDE-RANK
  DISTANCE-FROM-CENTER-IN-FILES
  DISTANCE-FROM-CENTER-IN-RANKS
  DISTANCE-FROM-CENTER-IN-ROOK-STEPS
  DISTANCE-FROM-CENTER-IN-KING-MOVES 
  DISTANCE-FROM-HIS-K-IN-FILES
  DISTANCE-FROM-HIS-K-IN-RANKS
  DISTANCE-FROM-HIS-K-IN-ROOK-STEPS
  DISTANCE-FROM-HIS-K-IN-KING-MOVES

  DISTANCE-FROM-OUR-K-IN-FILES
  DISTANCE-FROM-OUR-K-IN-RANKS
  DISTANCE-FROM-OUR-K-IN-ROOK-STEPS
  DISTANCE-FROM-OUR-K-IN-KING-MOVES

  DISTANCE-FROM-CENTER-IN-FILES
  DISTANCE-FROM-CENTER-IN-RANKS
  DISTANCE-FROM-CENTER-IN-ROOK-STEPS
  DISTANCE-FROM-CENTER-IN-KING-MOVES 
))

(DEFUN C-POST-SETUP (PC)
 (PROG (SIDE LOC OUR-KL HIS-KL)
       (SETQ SIDE (LOGAND PC #o20))
       (SETQ OUR-KL (AR-1 PIECE-ARRAY (+ SIDE WK)))
       (SETQ HIS-KL (AR-1 PIECE-ARRAY (* (LOGXOR #o20 SIDE) WK)))
       (SETQ LOC (AR-1 PIECE-ARRAY PC))
       (SETQ OUR-SIDE-RANK (AR-1 C-BOARD-WHITE-RANK-NUMBER LOC))
       (COND ((NOT (ZEROP SIDE))
	      (SETQ OUR-SIDE-RANK (- 9 OUR-SIDE-RANK))))
       (MULTIPLE-VALUE (DISTANCE-FROM-OUR-K-IN-FILES DISTANCE-FROM-OUR-K-IN-RANKS 
			DISTANCE-FROM-OUR-K-IN-ROOK-STEPS DISTANCE-FROM-OUR-K-IN-KING-MOVES)
		       (C-COMPUTE-DISTANCE LOC OUR-KL))
       (MULTIPLE-VALUE (DISTANCE-FROM-HIS-K-IN-FILES DISTANCE-FROM-HIS-K-IN-RANKS 
			DISTANCE-FROM-HIS-K-IN-ROOK-STEPS DISTANCE-FROM-HIS-K-IN-KING-MOVES)
		       (C-COMPUTE-DISTANCE LOC HIS-KL))
       (MULTIPLE-VALUE (DISTANCE-FROM-CENTER-IN-FILES DISTANCE-FROM-CENTER-IN-RANKS
			DISTANCE-FROM-CENTER-IN-ROOK-STEPS DISTANCE-FROM-CENTER-IN-KING-MOVES)
		       (C-COMPUTE-DISTANCE LOC (C-NEAREST-CENTER-SQUARE LOC)))
))

(DEFUN C-NEAREST-CENTER-SQUARE (SQ)
       (COND ((>= SQ WKR4)
	      (COND ((<= (AR-1 C-BOARD-FILE-NUMBER SQ) 4)
		     WK5)
		    (T WQ5)))
	     (T
	      (COND ((<= (AR-1 C-BOARD-FILE-NUMBER SQ) 4)
		     WK4)
		    (T WQ4)))))

(DEFUN C-COMPUTE-DISTANCE (S1 S2)
 (PROG (RANKD FILED)
       (SETQ RANKD (ABS (- (AR-1 C-BOARD-WHITE-RANK-NUMBER S1)
			   (AR-1 C-BOARD-WHITE-RANK-NUMBER S2))))
       (SETQ FILED (ABS (- (AR-1 C-BOARD-FILE-NUMBER S1)
			   (AR-1 C-BOARD-FILE-NUMBER S2))))
       (RETURN FILED RANKD (+ FILED RANKD) (MAX FILED RANKD))))

(DEFUN C-COMPUTE-KING-STEPS-DISTANCE (S1 S2)
       (MAX (ABS (- (AR-1 C-BOARD-WHITE-RANK-NUMBER S1)
		    (AR-1 C-BOARD-WHITE-RANK-NUMBER S2)))
	    (ABS (- (AR-1 C-BOARD-FILE-NUMBER S1)
		    (AR-1 C-BOARD-FILE-NUMBER S2)))))

(DEFUN C-COMPUTE-ROOK-STEPS-DISTANCE (S1 S2)
       (+ (ABS (- (AR-1 C-BOARD-WHITE-RANK-NUMBER S1)
		  (AR-1 C-BOARD-WHITE-RANK-NUMBER S2)))
	  (ABS (- (AR-1 C-BOARD-FILE-NUMBER S1)
		  (AR-1 C-BOARD-FILE-NUMBER S2)))))

(DEFUN C-POST-KING (POST-KEYS SQ))
(DEFUN C-POST-QUEEN (POST-KEYS SQ))
(DEFUN C-POST-ROOK (POST-KEYS SQ))
(DEFUN C-POST-BISHOP (POST-KEYS SQ))

;IF N ON N1 AND R ON R1, N IS UNDEVELOPED
;IF N WITHIN 2 KING-STEPS OF OUR K, IT IS IN K-DEFENSIVE POSITION
;IF N WITHIN 0 KING-STEPS OF CENTER, OR 1 ROOK STEP AND ON OUR 6TH RANK (IE K6 OR Q6),
;   IT IS HIGHLY-CENTRALIZED
;IF N WITHIN 1 KING-STEPS OF CENTER, IT IS CENTRALIZED
;IF N 3 KING-STEPS FROM CENTER, IT IS ON-EDGE-OF-BOARD
;IF N WITHIN 4 KING-STEPS OF HIS K, IT IS IN K-ATTACKING POSITION

;
(DEFUN C-POST-KNIGHT (POST-KEYS SQ)
)

;PAWN POSTING
;  CENTER 
;  RANGER HOME
;  FREE 
;   PASSER
;    PROTECTED-PASSER
;   GUARDED-SQUARE(S)
;    FAKER
;    CANDIDATE
;  UNFREE
;   SNEAKER
;   RAM  GOOD FOR DEFENSE
;  DUO
;
;POSTING OF P S DONE BY PAWN GROUPS AND BY REGION, NOT INDIVIDUAL PAWNS
(DEFUN C-POST-B-PAWN (POST-KEYS SQ))
(DEFUN C-POST-W-PAWN (POST-KEYS SQ))
