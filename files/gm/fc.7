TS=0

TITLE FILE CHECKER

I=0
A=1
B=2
C=3
D=4
P=5
ADR=6
CKS=7
T=10
TT=11
IFE TS,[X=12
DIFF=13
HEAD=14
TRACK=15
UNIT=16
BUFP=17
EXPUNG .OPEN,.IOT,.VALUE
]
IFN TS,[TYIC==1
TYOC==2
IN==3
]
LODF==1
VRBF==2

BEG:IFE TS,[CONO 635550
	CONO PI,11577
]IFN TS,[.OPEN TYIC,[SIXBIT \   TTY\]
	.VALUE
	.OPEN TYOC,[SIXBIT \  !TTY\]
	.VALUE
]LUP:	MOVEI P,PDL-1
IFE TS,[MOVEI X,"*
	PUSHJ P,TYO
]IFN TS,	.IOT TYOC,["*]
	MOVEI I,0
LUP1:	PUSHJ P,TYI
	CAIN A,"L
	TRO I,LODF
	CAIN A,"V
	TRO I,VRBF
	CAIN A,"Q
	.BREAK 16,
;	CAIN A,"E
;	JRST EXAM
	CAIE A,33
	JRST LUP1
FRD:	MOVEI C,0
	MOVE B,[440600,,C]
FRD1:	PUSHJ P,TYI
IFN TS,[CAIN A,":
	JRST FRDD
]	CAIN A,";
	JRST FRDS
	CAIN A,40
	JRST FRDF1
	CAIN A,15
	JRST FRDF2
	SUBI A,40
	TLNE B,770000
	IDPB A,B
	JRST FRD1
IFN TS,[FRDD:	JUMPL B,FRD1
	HLRM C,INF
	JRST FRD
]FRDS:	JUMPL B,FRD1
	.WSNAM C,
	JRST FRD
FRDF1:	JUMPL B,FRD1
	MOVEM C,FN1
	JRST FRD
FRDF2:	JUMPL B,FRDF3
	MOVEM C,FN2
FRDF3:IFN TS,[.OPEN IN,INF
	JRST FNF
]	CLEARB D,LBLOCK'
	AOS LBLOCK
	CLEARM WRDCNT'
	MOVEI ADR,BUF
	TRNE I,LODF
	AOS TT,ADR
LOAD:	PUSHJ P,RD1
	CAME A,[JRST 1]
	JRST LOAD
CHK1:	PUSHJ P,RD1
	JUMPN D,CHK1B
	HRRZM A,1ADR
	HRRZM A,LADR'
CHK1B:	HRRZ B,A
	CAMN B,LADR
	JRST CHK2
	PUSHJ P,PBNS
	MOVEM D,LBLOCK
	AOS LBLOCK
	MOVE B,1ADR'
	HRRZM A,1ADR
	TRNN I,LODF
	JRST CHK1A
	MOVE T,LADR
	MOVEM T,-1(TT)
	HRLM B,-1(TT)
	AOS TT,ADR
CHK1A:	TRNN I,VRBF
	JRST CHK2
	PUSHJ P,DPT
	SOS B,LADR
IFE TS,[MOVEI X,"-
	PUSHJ P,TYO
]IFN TS,	.IOT TYOC,["-]
	PUSHJ P,DPT
	PUSHJ P,CR
CHK2:	JUMPGE A,LOADS
	HRRZ B,A
	HLREM A,LADR
	SUBM B,LADR
	TRNN I,LODF
	MOVEI ADR,BUF
	PUSHJ P,RDB
	AOJA D,CHK1
DPT:	MOVMS B
DPT1:	IDIVI B,10
	JUMPE B,DPT2
	HRLM C,(P)
	PUSHJ P,DPT1
	HLRZ C,(P)
DPT2:IFN TS,[	ADDI C,"0
	.IOT TYOC,C
	POPJ P,
]IFE TS,[MOVEI X,"0(C)
	JRST TYO
]
IFN TS,[RD1:HRROI B,A
	.IOT IN,B
	JUMPGE B,CPOPJ
TYI:	.IOT TYIC,A
	CAIN A,177
	JRST LUP
	POPJ P,
CR:	.IOT TYOC,[15]
	.IOT TYOC,[12]
	POPJ P,
]EOF:	PUSHJ P,PBN
	MOVEI C,[ASCIZ \EOF\]
	JRST ERROR1
PBNS:	TRNN I,VRBF
CPOPJ:	POPJ P,
PBNS1:	CAMGE D,LBLOCK
	POPJ P,
	CAMN D,LBLOCK
	JRST PBN
	MOVEI C,[ASCIZ \BLOCKS \]
	PUSHJ P,PRT
	MOVE B,LBLOCK
	PUSHJ P,DPT
IFE TS,[MOVEI X,"-
	PUSHJ P,TYO
]IFN TS,	.IOT TYOC,["-]
	MOVE B,D
	PUSHJ P,DPT
IFE TS,[MOVEI X,40
	PUSHJ P,TYO
]IFN TS,.IOT TYOC,[40]
	POPJ P,
RDB:	MOVE CKS,A
	HRR A,ADR
IFE TS,	PUSHJ P,READ
IFN TS,[.IOT IN,A
	JUMPL A,EOF
]	HLLZ A,CKS
	HRRM ADR,RDB3
	HLRE T,CKS
	SUB ADR,T
	ADDM T,WRDCNT
RDB2:	ROT CKS,1
RDB3:	ADD CKS,.(A)
	AOBJN A,RDB2
	PUSHJ P,RD1
	CAMN A,CKS
	POPJ P,
	PUSHJ P,PBN
	MOVEI C,[ASCIZ \CKSERR
\]?PRT:	HRLI C,440700
PRT1:	ILDB B,C
	JUMPE B,CPOPJ
IFN TS,	.IOT TYOC,B
IFE TS,[MOVE X,B
	PUSHJ P,TYO
]	JRST PRT1
PBN:	MOVEI C,[ASCIZ \BLOCK \]
	PUSHJ P,PRT
	MOVE B,D
	PUSHJ P,DPT
IFE TS,[MOVEI X,40
	PUSHJ P,TYO
]IFN TS,.IOT TYOC,[40]
	POPJ P,
FNF:	MOVEI C,[ASCIZ \FILE NOT FOUND\]
ERROR1:	PUSHJ P,PRT
ERROR:IFE TS,[MOVEI X,"?
	PUSHJ P,TYO
]IFN TS,	.IOT TYOC,["?]
	PUSHJ P,CR
	JRST LUP
LOADS:	MOVEI C,[ASCIZ \SADR=\]
	PUSHJ P,PRT
	HRRZ B,A
	PUSHJ P,DPT
	PUSHJ P,CR
	MOVEI A,1
	MOVEM A,LBLOCK
	TRNN I,VRBF
	PUSHJ P,PBNS1
	MOVEM D,LBLOCK
	AOS LBLOCK
	MOVM B,WRDCNT
	PUSHJ P,DPT
	MOVEI C,[ASCIZ \ STORAGE WORDS
\]?	PUSHJ P,PRT
	CLEARM WRDCNT
LOADS1:	PUSHJ P,RD1
	JUMPGE A,LOADS2
	TRNN I,LODF
	MOVEI ADR,BUF
	PUSHJ P,RDB
	AOJA D,LOADS1
LOADS2:	PUSHJ P,PBNS1
	MOVM B,WRDCNT
	LSH B,-1
	PUSHJ P,DPT
	MOVEI C,[ASCIZ \ SYMBOLS
\]?	PUSHJ P,PRT
	TRNN I,LODF
	JRST LUP
	SUBM TT,ADR
	HRLM ADR,TT
	MOVEM TT,SYMPTR'
	JRST LUP
IFE TS,[TYI:CONSO TTY,40
	JRST .-1
	DATAI TTY,A
	ANDI A,177
	SKIPA X,A
CR:	HRROI X,15
TYO:	CONSZ TTY,20
	JRST .-1
	DATAO TTY,X
	JUMPGE X,CPOPJ
	MOVEI X,12
	JRST TYO
]IFN TS,INF:	SIXBIT \  "DSK\
FN1:	0
FN2:	0
PDL:	BLOCK 10
CON:	CONSTA?VARIAB
IFE TS,[LOC .\1777+1
DBUF:	BLOCK 2000
]BUF:	BLOCK 400
END BEG
ð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒð0`Áƒ